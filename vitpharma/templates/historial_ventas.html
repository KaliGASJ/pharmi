{% extends 'base.html' %}

{% block title %}Historial de Ventas | VIT PHARMA{% endblock %}

{% block content %}
<style>
    .historial-container {
        max-width: 95%;
        margin: auto;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
    }

    .header-title {
        font-size: 24px;
        font-weight: bold;
        color: #004AAD;
        margin-bottom: 20px;
        text-align: center;
    }

    .filtros-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .filtros-form {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .filtros-form label {
        font-weight: bold;
    }

    .filtros-form input[type="date"] {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .filtros-form button {
        padding: 8px 15px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }

    .back-button {
        padding: 8px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: inline-block;
    }

    .back-button:hover {
        background-color: #5a6268;
    }

    .ventas-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .ventas-table th, .ventas-table td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }

    .ventas-table th {
        background-color: #004AAD;
        color: white;
        font-weight: bold;
    }

    .ventas-table tr:hover {
        background-color: #f5f5f5;
    }

    .btn-detalle {
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 5px 10px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-right: 5px;
    }

    .btn-ticket {
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 5px 10px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }

    .btn-detalle:hover, .btn-ticket:hover {
        opacity: 0.9;
    }

    .no-results {
        text-align: center;
        padding: 20px;
        color: #6c757d;
        font-style: italic;
        background-color: #f8f9fa;
        border-radius: 5px;
    }

    .stats-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .stat-card {
        flex: 1;
        min-width: 200px;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.1);
    }

    .stat-card.total-ventas {
        background-color: #e8f5e9;
        border-left: 5px solid #4caf50;
    }

    .stat-card.total-monto {
        background-color: #e3f2fd;
        border-left: 5px solid #2196f3;
    }

    .stat-card.promedio-venta {
        background-color: #fff8e1;
        border-left: 5px solid #ffc107;
    }

    .stat-title {
        font-size: 14px;
        color: #555;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 22px;
        font-weight: bold;
        color: #333;
    }
</style>

<div class="historial-container">
    <h2 class="header-title">üìù Historial de Ventas</h2>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} text-center mb-3">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Filtros -->
    <div class="filtros-container">
        <form class="filtros-form" method="get">
            <label for="fecha">Filtrar por fecha:</label>
            <input type="date" id="fecha" name="fecha" value="{{ fecha|default:'' }}">
            <button type="submit">Filtrar</button>
            {% if fecha %}
                <a href="{% url 'ventas:historial_ventas' %}" class="back-button">Limpiar filtro</a>
            {% endif %}
        </form>
        <a href="{% url 'ventas:registro_venta' %}" class="back-button">‚Üê Volver a Ventas</a>
    </div>

    <!-- Estad√≠sticas r√°pidas -->
    {% if ventas %}
    <div class="stats-container">
        <div class="stat-card total-ventas">
            <div class="stat-title">Total Ventas</div>
            <div class="stat-value">{{ ventas.count }}</div>
        </div>
        <div class="stat-card total-monto">
            <div class="stat-title">Monto Total</div>
            <div class="stat-value">${{ total_monto|floatformat:2 }}</div>
        </div>
        <div class="stat-card promedio-venta">
            <div class="stat-title">Promedio por Venta</div>
            <div class="stat-value">${{ promedio_venta|floatformat:2 }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Tabla de ventas -->
    {% if ventas %}
    <table class="ventas-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>M√©todo de Pago</th>
                <th>Turno</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for venta in ventas %}
            <tr>
                <td>{{ venta.id }}</td>
                <td>{{ venta.fecha_hora|date:"d/m/Y" }}</td>
                <td>{{ venta.fecha_hora|time:"H:i" }}</td>
                <td>{{ venta.metodo_pago.nombre|default:"No especificado" }}</td>
                <td>#{{ venta.turno.id }}</td>
                <td>${{ venta.total }}</td>
                <td>
                    <a href="{% url 'ventas:detalle_venta' venta.id %}" class="btn-detalle">üëÅÔ∏è Detalles</a>
                    {% if venta.archivo_ticket %}
                        <a href="{% url 'ventas:descargar_ticket' venta.id %}" class="btn-ticket">üßæ Ticket</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="no-results">
        <p>No se encontraron ventas{% if fecha %} para la fecha seleccionada{% endif %}.</p>
    </div>
    {% endif %}
</div>
{% endblock %}